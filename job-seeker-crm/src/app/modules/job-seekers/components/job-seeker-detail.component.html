<ng-container *ngIf="jobSeeker; else loading">
  <mat-card class="detail-card">
    <div class="detail-header">
      <button mat-button type="button" (click)="backToList()">
        <mat-icon>arrow_back</mat-icon>
        Back to list
      </button>
      <div class="identity">
        <div class="avatar">{{ jobSeeker.name | slice:0:1 }}</div>
        <div>
          <h2>{{ jobSeeker.name }}</h2>
          <p class="muted">{{ jobSeeker.email }}</p>
        </div>
      </div>
      <div class="status-chip" [ngClass]="detailForm.value.status">
        <mat-icon>adjust</mat-icon>
        {{ detailForm.value.status }}
      </div>
    </div>

    <mat-divider></mat-divider>

    <section class="status-quick">
      <h3>Status quick actions</h3>
      <mat-chip-listbox aria-label="Select CRM status">
        <mat-chip-option
          *ngFor="let status of statuses"
          [selected]="detailForm.value.status === status"
          (click)="setStatus(status)"
        >
          {{ status }}
        </mat-chip-option>
      </mat-chip-listbox>
    </section>

    <form [formGroup]="detailForm" (ngSubmit)="saveChanges()" class="detail-grid">
      <mat-form-field appearance="outline">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option *ngFor="let status of statuses" [value]="status">{{ status }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Preference</mat-label>
        <input matInput formControlName="preference" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Last contacted</mat-label>
        <input matInput type="date" formControlName="lastContacted" />
        <mat-hint>Use quick action to log a touchpoint today.</mat-hint>
      </mat-form-field>

      <div class="campaign-selector">
        <div class="selector-header">
          <h3>Campaign enrollments</h3>
          <span class="muted">{{ (detailForm.value.campaigns as number[]).length }} selected</span>
        </div>
        <mat-selection-list formControlName="campaigns" class="campaign-list">
          <mat-list-option
            *ngFor="let campaign of campaigns"
            [value]="campaign.id"
            (click)="toggleCampaign(campaign.id)"
          >
            <mat-icon matListIcon>{{ (detailForm.value.campaigns as number[]).includes(campaign.id) ? 'check_circle' : 'campaign' }}</mat-icon>
            <div matLine>{{ campaign.name }}</div>
            <div matLine class="muted">{{ campaign.stage }}</div>
          </mat-list-option>
        </mat-selection-list>
      </div>
      <div class="actions">
        <button mat-stroked-button type="button" (click)="markContactedToday()">
          <mat-icon>calendar_today</mat-icon>
          Mark contacted today
        </button>
        <span class="spacer"></span>
        <button mat-flat-button color="primary" type="submit" [disabled]="detailForm.invalid">
          <mat-icon>save</mat-icon>
          Save changes
        </button>
      </div>
    </form>
  </mat-card>
</ng-container>

<ng-template #loading>
  <div class="loading-state">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>
